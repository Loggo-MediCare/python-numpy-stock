# 期貨交易系統（PDF 方法論 v3.0）中文說明

## 目的
此腳本以「PDF 多模組方法論 v3.0」為核心，透過多重技術指標、風險控制與機器學習驗證，提供期貨市場的買進信號判斷與回測評估。

## 功能概要
- **資料取得**：優先從 Yahoo Finance 下載指定標的（預設台積電期貨 2330.TW），失敗時自動生成模擬價格序列。
- **技術與風險指標**：計算 RSI、MACD、KD、OBV、布林帶、移動平均線、日報酬、波動率、ATR、20 日 Sharpe Ratio、20 日滾動最大回撤。
- **多模組買進信號**：依 PDF 方法論設計五個模組，將觸發結果整合成 0~1 的買進信號強度並記錄觸發模組。
- **機器學習驗證**：以 Random Forest 對 20 日未來方向做時間序列分割交叉驗證，檢視指標組合的分類效果。
- **績效評估**：針對不同置信度門檻（0.70/0.75/0.80）計算信號後 20 日的勝率、平均報酬、Sharpe Ratio、最大損益與獲利因子。
- **中文視覺化支援**：自動安裝中文字體並設定 matplotlib，避免中文亂碼。

## 五大買進模組
1. **超賣反彈模組**：RSI < 30、MACD 正向、K > D，鎖定極度超賣反彈機會。
2. **K 線極度超賣模組**：K < 5、RSI < 25 且價格仍在布林下軌之上，針對 K=0/低於 5 的特殊情況。
3. **雙指標確認模組**：K 上穿 D、MACD > Signal、OBV > OBV_MA_20，著重量價多重確認。
4. **趨勢追蹤模組**：收盤價 > MA20、MA20 > MA50、MACD 正向、K > 50，符合上升趨勢中的順勢買點。
5. **風險調整模組**：Sharpe_20d > 1、max_dd_20d > -0.15、RSI < 40、MACD 正向，強調風險可控的進場。

## 執行方式
```bash
python futures_trading_system.py
```
執行後腳本會輸出：
- 指標計算狀態與模組觸發次數
- 買進信號統計與當前市場狀態
- 隨機森林訓練與交叉驗證結果（資料量不足則跳過）
- 各置信度門檻下的績效評估

## 依賴套件
核心套件包含 `pandas`、`numpy`、`yfinance`、`matplotlib`、`scikit-learn`、`arch`。若環境未安裝，請先執行：
```bash
pip install pandas numpy yfinance matplotlib scikit-learn arch
```

## 注意事項
- 無法連網時會自動生成模擬資料，仍可完成指標計算與模組觸發流程。
- 適用於教學與策略原型，真實交易需搭配風險控管與更嚴謹的回測。
- 若需更換標的，可在腳本中調整 `futures_symbols` 或 `selected_future`。
